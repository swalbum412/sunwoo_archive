<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>swpm</title>

    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/board.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/main.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.min.js" integrity="sha512-mMe7BAZPOkGbq+zhRBMNV3Q+5ZDzcUEOJoUYXbHpEcODkDBYbttaW7P108jX66AQgwgsAjvlP4Ayb/XLJZfmsg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="./js/jquery-3.5.1.min.js"></script>
    <script src="./js/index.js"></script>
    <script>
        $(document).ready(function() {
            // 팝업 창 닫기
            $('.popup_close').on('click', function() {
                console.log('d')
                $('.popup-layer').css('display', 'none')
            })

             // 메시지 마지막에 시간 추가하기
            // var minute_last_msg = $('.msg-list li').last();
            // minute_last_msg.append('<div class="msg-time"><span>04:12</span></div>')

            // 엔터 키 활성화
            $('#input_search').keydown(function(key) {
                if(key.keyCode == 13) {
                    console.log('enter')
                }
            })

            // 검색
            var keyword;
            var temp;

            $('#input_search').keyup(function() {
                keyword = $(this).val();
                temp = $('.msg:contains("' + keyword + '")'); // class="msg" 인 것 중 keyword를 찾는다.                
                console.log(temp)
            })

            $('#btn_search').on('click', function() {
                var offset = $(temp[i]).offset(); // 선택한 요소의 위치를 반환
                $('.middle').animate({scrollTop : offset.top - 40}, 400);    
            })        
            
        })

        $(function() {
            // 모바일 사이드 메뉴 버튼
            $('.menu').on('click', function() {
                $('.side-wrap').addClass('active')
                $('body').css('overflow-y','hidden')
            })

            // 모바일 사이드 메뉴 닫기
            $('.btn-prev.side').on('click', function(){
                $('.side-wrap').removeClass('active')
                $('body').css('overflow-y','scroll')
            })

            // 검색창 활성화
            $('.search').on('click', function() {
                $('.top-search').addClass('active')
                $('#input_search').focus();
                $('.top-header').css('display', 'none')
            })

            // 검색창 비활성화
            $('.cancel-search').on('click', function() {
                $('.top-search').removeClass('active');
                $('.top-header').css('display', 'flex')
            })

        })

        // 이미지 다운로드
        function dataURLtoBlob(dataurl) {
            var arr = dataurl.split(','),
            mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]),
            n = bstr.length,
            u8arr = new Uint8Array(n);

            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {
                type: mime
            });
        }

        function downloadImg(imgSrc) {
            var image = new Image();
            image.crossOrigin = "anonymous";
            image.src = imgSrc;
            var fileName = image.src.split("/").pop();
            
            image.onload = function() {
                var canvas = document.createElement('canvas');
                canvas.width = this.width;
                canvas.height = this.height;
                canvas.getContext('2d').drawImage(this, 0, 0);

                if (typeof window.navigator.msSaveBlob !== 'undefined') {
                    window.navigator.msSaveBlob(dataURLtoBlob(canvas.toDataURL()), fileName);
                } else {
                    var link = document.createElement('a');
                    link.href = canvas.toDataURL();
                    link.download = fileName;
                    link.click();
                }
            };
        }
    </script>
</head>
<body>
    <!-- 이미지 팝업 -->
    <div class="popup-layer" style="display: none;">
        <div class="popup-box">
            <div class="popup-header flexbox jc-between ai-center">
                <button class="popup_close">
                    <img src="./images/ico_prev.png" alt="">
                </button>
                <img src="./images/ico_down.png" onclick="downloadImg('./images/210529.jpg');" alt="" style="cursor: pointer;">
            </div>
            <div class="popup-body flexbox ai-center" id="popup_back">
                <div class="popup-media">
                    <img src="./images/210529.jpg" id="msg_img" alt="">
                </div>
            </div>
        </div>
    </div>
    <!-- 아이프레임 팝업 -->
    <div class="popup-layer" style="display: none;" id="popup_iframe">
        <div class="popup-box">
            <div class="popup-header flexbox jc-between ai-center">
                <button class="popup_close">
                    <img src="./images/ico_prev.png" alt="">
                </button>
            </div>
            <div class="popup-body flexbox ai-center" id="popup_back">
                <div class="popup-media">
                    <iframe src="https://drive.google.com/file/d/1atLY0dyz6aMbZgfJ0O21wYaqX5BvY1wM/preview" frameborder="0"></iframe>
                </div>
            </div>
        </div>
    </div>
    <div class="wrap">
        <div class="content-wrap">
            <div class="side-wrap">
                <div class="side-menu-wrap">
                    <div class="side-top flexbox ai-center">
                        <button class="btn-prev side">
                            <img src="./images/ico_prev.png" alt="">
                        </button>
                        <h3 class="chat-name">김선우</h3>
                        <span class="detail-name">THE BOYZ · 선우</span>
                    </div>
                </div>
            </div>
            <section class="top top-header flexbox ai-center jc-between">
                <div class="left flexbox ai-center">
                    <button class="btn-prev" onclick="history.go(-1)">
                        <img src="./images/ico_prev.png" alt="">
                    </button>
                    <h3 class="chat-name">김선우</h3>
                </div>
                <div class="right">
                    <button class="search">
                        <img src="./images/ico_search.png" alt="">
                    </button>
                    <button class="menu">
                        <img src="./images/ico_menu.png" alt="">
                    </button>
                </div>
            </section>
            <section class="middle">
                <div class="day-line">
                    <span class="day" id="day">01.31</span>
                </div>
                <!-- 틀 -->
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg"></p><div class="msg-time"><span>11:18</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">귀여미 @@ 기다렸지 많이 미안 늦어서 ㅎ</p><div class="msg-time"><span>11:18</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">@@ 안 삐졌지?</p><div class="msg-time"><span>11:19</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">예뻐~</p><div class="msg-time"><span>11:20</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">이거 신기하네 진짜</p><div class="msg-time"><span>11:21</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">밥은 먹었구?? 저는 먹었어요 앞으로 자주 올게요</p><div class="msg-time"><span>11:23</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">난 편의점 음식 먹었으 ㅋㅋㅋ @@ 더 맛난 거 먹어</p><div class="msg-time"><span>11:24</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">@@!! 나 연락 더 하고픈데 지금 가야해 ㅠ이따 연락 또 할게요 ㅎ 사랑해요 (하트 이</p><div class="msg-time"><span>11:29</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">(하트이모티콘)</p><div class="msg-time"><span>11:30</span></div></li>                        
                    </ul>
                </div>
                <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="./images/profile_01.PNG" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">나 왔다</p><div class="msg-time"><span>13:05</span></div></li>                        
                    </ul>
                </div>
                
                <!-- <div class="msg-wrap flexbox">
                    <div class="profile-img">
                        <img src="" alt="">
                    </div>
                    <ul class="msg-list">
                        <h4 class="profile-name">김선우</h4>
                        <li><p class="msg">@@ 안 삐졌지?</p></li>
                        <li><p class="msg">예뻐~</p></li>
                        <li><p class="msg">이거 신기하네 진짜</p></li>
                        <li><p class="msg">밥은 먹었구?? 저는 먹었어요 앞으로 자주 올게요</p></li>
                        <li><p class="msg">난 편의점 음식 먹었으 ㅋㅋㅋ @@ 더 맛난 거 먹어</p></li>
                        <li><p class="msg">@@!! 나 연락 더 하고픈데 지금 가야해 ㅠ이따 연락 또 할게요 ㅎ 사랑해요 (하트 이</p></li>
                        <li><p class="msg">(하트이모티콘)</p></li>
                        <li><p class="msg">나 왔다</p></li>
                        <li><p class="msg">ㅋㅋㅋㅋ 금방 왔죠~</p></li>
                        <li><p class="msg">점심 먹은 사람!!</p></li>
                        <li><p class="msg">아 미안 우리 둘만 있구나 점심 먹었어 @@?</p></li>
                        <li><p class="msg">오늘 날씨도 좋은데 안전하게 집에 있어요 ㅎㅎ</p></li>
                        <li><p class="msg">답장이 좀 늦어도 이해해줘….ㅎㅎ</p></li>
                        <li>
                            <div class="video msg">
                                <div class="thumb">
                                    <button class="btn-play">
                                        <img src="./images/ico_play.png" alt="">
                                    </button>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p class="msg">test4</p>
                        </li>
                        <li>
                            <p class="audio msg">
                                <a href="https://drive.google.com/file/d/1atLY0dyz6aMbZgfJ0O21wYaqX5BvY1wM/view?usp=share_link" target="_blank">
                                    <button class="btn-play flexbox ai-center jc-center">
                                        <img src="./images/ico_play_audio.png" alt="">
                                    </button>
                                    <span>04:12</span>
                                </a>
                            </p>
                        </li>
                    </ul>
                </div> -->
            </section>
            <section class="bottom"></section>
        </div>
    </div>
</body>
</html>